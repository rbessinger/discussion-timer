<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discussion Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind CSS to use the 'class' strategy for dark mode
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        html {
             scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Simple transition for highlighting agenda items */
        .agenda-item {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-300">
    <div class="w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden relative transition-colors duration-300">
             <!-- Dark Mode Toggle -->
            <button id="dark-mode-toggle" class="absolute top-4 right-4 md:top-6 md:right-6 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-all duration-200">
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>

            <div class="p-6 md:p-10">
                <div class="text-center md:text-left">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-gray-100">People Discussion</h1>
                    <p class="text-lg text-gray-500 dark:text-gray-400 mt-1">Total Session Time: 20 minutes</p>
                </div>

                <!-- Timer Display -->
                <div class="my-8 text-center bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                    <p id="current-task" class="text-xl md:text-2xl font-semibold text-indigo-600 dark:text-indigo-400 mb-2">Ready to start</p>
                    <div id="timer-display" class="text-7xl md:text-9xl font-black text-gray-900 dark:text-white tracking-tighter">
                        01:00
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="start-pause-btn" class="w-full sm:w-48 text-lg font-semibold py-3 px-6 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-all duration-200">
                        Start
                    </button>
                    <button id="reset-btn" class="w-full sm:w-48 text-lg font-semibold py-3 px-6 bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 dark:focus:ring-offset-gray-800 transition-all duration-200">
                        Reset
                    </button>
                </div>

                <!-- Sound Settings -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-center text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4">Sound Settings</h3>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-8">
                        <div class="flex items-center gap-2">
                            <label for="sound-select" class="font-medium text-gray-600 dark:text-gray-300">Alarm Sound:</label>
                            <select id="sound-select" class="rounded-md border-gray-300 dark:bg-gray-600 dark:border-gray-500 dark:text-white shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="beep">Beep</option>
                                <option value="chime">Chime</option>
                                <option value="alert">Alert</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2 w-full max-w-xs sm:w-56">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 dark:text-gray-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>
                            <input id="volume-slider" type="range" min="0" max="1" step="0.05" value="0.5" class="w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 dark:text-gray-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
                        </div>
                    </div>
                </div>
                
                 <!-- Progress Bar -->
                <div class="mt-8">
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Overall Progress</p>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

            </div>
            
            <!-- Agenda List -->
            <div class="bg-gray-50 dark:bg-gray-800 dark:border-t dark:border-gray-700 p-6 md:p-8">
                <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">Breakdown</h2>
                <div id="agenda-list" class="space-y-3">
                    <!-- Agenda items will be injected here by JavaScript -->
                </div>
            </div>
        </div>
        <footer class="text-center mt-6 text-gray-500 dark:text-gray-400 text-sm">
            <p>Built by rbessinger@ to streamline your discussion flow.</p>
        </footer>
    </div>

    <script>
        // --- App Constants ---
        const agenda = [
            { label: "Manager states: Candidate Info", duration: 60 },
            { label: "Pre-Reviewer 1 shares feedback", duration: 120 },
            { label: "Pre-Reviewer 2 shares feedback", duration: 120 },
            { label: "Manager answers questions", duration: 480 },
            { label: "Confidence Poll", duration: 120 },
            { label: "Notetaker presents notes", duration: 300 }
        ];
        const totalSessionTime = agenda.reduce((sum, item) => sum + item.duration, 0);

        // --- DOM Elements ---
        const timerDisplay = document.getElementById('timer-display');
        const currentTaskDisplay = document.getElementById('current-task');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const agendaListContainer = document.getElementById('agenda-list');
        const progressBar = document.getElementById('progress-bar');
        const soundSelect = document.getElementById('sound-select');
        const volumeSlider = document.getElementById('volume-slider');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        
        // --- State ---
        let currentAgendaIndex = 0;
        let timeLeft = agenda[0].duration;
        let isRunning = false;
        let timerInterval = null;
        let synths = {};
        let selectedSound = 'beep';
        let currentVolume = 0.5;

        // --- Functions ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function playSound() {
            if (currentVolume === 0) return; // Don't play if muted
            const synth = synths[selectedSound];
            if (!synth) return;
            const volumeInDb = (currentVolume * 40) - 40;
            synth.volume.value = volumeInDb;
            const now = Tone.now();
            if (selectedSound === 'beep') {
                synth.triggerAttackRelease("C5", "0.8", now);
            } else if (selectedSound === 'chime') {
                synth.triggerAttackRelease("G5", "1.5", now);
            } else if (selectedSound === 'alert') {
                synth.triggerAttackRelease("A5", "0.2", now);
                synth.triggerAttackRelease("A5", "0.2", now + 0.3);
            }
        }
        
        function updateDisplay() {
            const currentItem = agenda[currentAgendaIndex];
            timerDisplay.textContent = formatTime(timeLeft);
            
            if (isRunning || timeLeft < agenda[currentAgendaIndex].duration) {
                currentTaskDisplay.textContent = currentItem.label;
            } else if (!isRunning && timeLeft === agenda[currentAgendaIndex].duration && currentAgendaIndex === 0) {
                 currentTaskDisplay.textContent = "Ready to start";
            }

            document.querySelectorAll('.agenda-item').forEach((item, index) => {
                item.classList.toggle('bg-indigo-100', index === currentAgendaIndex);
                item.classList.toggle('text-indigo-800', index === currentAgendaIndex);
                item.classList.toggle('font-bold', index === currentAgendaIndex);
                item.classList.toggle('dark:bg-indigo-900/50', index === currentAgendaIndex);
                item.classList.toggle('dark:text-indigo-300', index === currentAgendaIndex);
                item.classList.toggle('bg-white', index !== currentAgendaIndex);
                item.classList.toggle('dark:bg-gray-700', index !== currentAgendaIndex);

                if (index !== currentAgendaIndex && isRunning) {
                    item.classList.add('cursor-pointer', 'hover:bg-indigo-50', 'dark:hover:bg-gray-600');
                    item.classList.remove('opacity-50');
                } else {
                    item.classList.remove('cursor-pointer', 'hover:bg-indigo-50', 'dark:hover:bg-gray-600');
                     if(index < currentAgendaIndex && !isRunning) {
                        item.classList.add('opacity-50');
                    } else {
                        item.classList.remove('opacity-50');
                    }
                }
            });
            
            const timeElapsed = totalSessionTime - agenda.slice(currentAgendaIndex).reduce((sum, item) => sum + item.duration, 0) + (agenda[currentAgendaIndex].duration - timeLeft);
            const progressPercentage = (timeElapsed / totalSessionTime) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function moveToNextItem() {
            playSound();
            currentAgendaIndex++;
            if (currentAgendaIndex < agenda.length) {
                timeLeft = agenda[currentAgendaIndex].duration;
                updateDisplay();
            } else {
                clearInterval(timerInterval);
                isRunning = false;
                timerDisplay.textContent = "Done!";
                currentTaskDisplay.textContent = "Session Complete";
                startPauseBtn.textContent = "Start";
                startPauseBtn.disabled = true;
                startPauseBtn.classList.add('opacity-50', 'cursor-not-allowed');
                progressBar.style.width = '100%';
                document.querySelectorAll('.agenda-item').forEach((item, index) => {
                    item.classList.remove('bg-indigo-100', 'text-indigo-800', 'font-bold', 'cursor-pointer', 'hover:bg-indigo-50', 'dark:bg-indigo-900/50', 'dark:text-indigo-300', 'dark:hover:bg-gray-600');
                    item.classList.add('opacity-50');
                });
            }
        }

        function tick() {
            if (timeLeft > 0) {
                timeLeft--;
            } else {
                moveToNextItem();
            }
            updateDisplay();
        }

        function startTimer() {
            if (isRunning) return;
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            isRunning = true;
            startPauseBtn.textContent = "Pause";
            timerInterval = setInterval(tick, 1000);
            updateDisplay();
        }

        function pauseTimer() {
            if (!isRunning) return;
            isRunning = false;
            startPauseBtn.textContent = "Resume";
            clearInterval(timerInterval);
            updateDisplay();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            currentAgendaIndex = 0;
            timeLeft = agenda[0].duration;
            startPauseBtn.textContent = "Start";
            startPauseBtn.disabled = false;
            startPauseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            updateDisplay();
        }

        function createAgendaList() {
            agendaListContainer.innerHTML = '';
            agenda.forEach((item, index) => {
                const durationInMins = item.duration / 60;
                const itemEl = document.createElement('div');
                itemEl.className = 'agenda-item flex justify-between items-center p-4 rounded-lg bg-white dark:bg-gray-700 shadow-sm transition-all duration-200';
                itemEl.setAttribute('data-index', index);
                itemEl.innerHTML = `
                    <p class="text-gray-700 dark:text-gray-200">${index + 1}. ${item.label}</p>
                    <p class="font-semibold text-gray-500 dark:text-gray-400 w-20 text-right">${durationInMins} min${durationInMins > 1 ? 's' : ''}</p>
                `;
                itemEl.addEventListener('click', () => {
                    // This now allows jumping to any item, anytime, as long as the timer is running.
                    if (isRunning) { 
                        jumpToItem(index);
                    }
                });
                agendaListContainer.appendChild(itemEl);
            });
        }
        
        function jumpToItem(index) {
            if (index < 0 || index >= agenda.length) return;
            currentAgendaIndex = index;
            timeLeft = agenda[currentAgendaIndex].duration;
            playSound();
            updateDisplay();
            if (startPauseBtn.disabled) {
                startPauseBtn.disabled = false;
                startPauseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                if (!isRunning) startPauseBtn.textContent = "Start";
            }
        }

        function initAudio() {
            synths.beep = new Tone.Synth().toDestination();
            synths.chime = new Tone.MetalSynth({ frequency: 250, envelope: { attack: 0.001, decay: 0.4, release: 0.2 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination();
            synths.alert = new Tone.FMSynth().toDestination();
        }

        // --- Dark Mode Logic ---
        function updateThemeIcons(isDark) {
            if (isDark) {
                // In dark mode, show the sun icon to switch to light mode
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                // In light mode, show the moon icon to switch to dark mode
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }
        }

        function applyTheme() {
            const isDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
            updateThemeIcons(isDark);
        }

        darkModeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            updateThemeIcons(isDark);
        });

        // --- Event Listeners ---
        startPauseBtn.addEventListener('click', () => { isRunning ? pauseTimer() : startTimer(); });
        resetBtn.addEventListener('click', resetTimer);
        soundSelect.addEventListener('change', (e) => { selectedSound = e.target.value; });
        volumeSlider.addEventListener('input', (e) => {
            currentVolume = parseFloat(e.target.value);
            if (Tone.context.state === 'running') playSound();
        });

        // --- Initial Setup ---
        window.onload = () => {
            applyTheme();
            initAudio();
            createAgendaList();
            resetTimer();
        };

    </script>
</body>
</html>
